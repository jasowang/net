Bottom: 3408319f4ed3c6a496102daa8ea44cf839ba9cb1
Top:    3408319f4ed3c6a496102daa8ea44cf839ba9cb1
Author: Jason Wang <jasowang@redhat.com>
Date:   2017-09-01 18:25:26 +0800

vhost_net: basic batched processing of vring

This patches implementing basic batched processing of vring by
prefetchig desc indices and update used ring in a batch. For
non-zerocopy case, vq->heads were used for storing the prefetched
indices and updating used ring. For zerocopy case and for simplicity,
batched processing were simply disabled by only fetch and process one
descriptor at a time.

XDP_DROP (without touching skb) on tun:

On Intel(R) Xeon(R) CPU E5-2630 v3 @ 2.40GHz (ERMS):
Before: 4.50Mpps
After:  5.53Mpps (+22%)

Intel(R) Xeon(R) CPU E5-2650 0 @ 2.00GHz (REP GOOD):
Before: 3.00Mpps
After:  3.70Mpps (+23%)

Batched descriptor fetching and translation could be done on top.

Signed-off-by: Jason Wang <jasowang@redhat.com>


---


