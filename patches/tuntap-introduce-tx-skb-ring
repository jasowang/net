Bottom: 27c7549eae5c28ea59ef611c7e653952533db73f
Top:    27c7549eae5c28ea59ef611c7e653952533db73f
Author: Jason Wang <jasowang@redhat.com>
Date:   2016-05-17 14:49:55 +0800

tuntap: switch to use skb ring for tx

We used to queue tx packets in sk_receive_queue, this is less
efficient since it requires spinlocks to synchronize between producer
and consumer.

This patch tries to address this by switching to use skb ring for tx
and:
- introduce a new proto_ops peek which could be implemented by
  specific socket which does not use sk_receive_queue.
- store skb length in circular buffer too, and implement a lockless
  peek for tuntap.
- change vhost_net to use proto_ops->peek() instead
- new spinlocks were introduced to synchronize among producers (and so
  did for consumers).

Pktgen test shows about 9% improvement on guest receiving pps:

Before: ~1480000pps
After : ~1610000pps

Signed-off-by: Jason Wang <jasowang@redhat.com>


---


