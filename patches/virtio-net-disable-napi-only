Bottom: cd3bc7da493e1d5d7163e2b22ef19bc7b9e51325
Top:    cd3bc7da493e1d5d7163e2b22ef19bc7b9e51325
Author: Jason Wang <jasowang@redhat.com>
Date:   2018-02-28 17:28:30 +0800

virtio-net: disable NAPI only when enabled during XDP set

We try to disable NAPI to prevent XDP TX queue to be used by multiple
cpus. But we don't check if device is up (napi is enabled), this could
result stall because of infinite wait in napi_disable(). Fixing this
by checking device state through netif_running() before.

Fixes: 4941d472bf95b ("virtio-net: do not reset during XDP set")

Signed-off-by: Jason Wang <jasowang@redhat.com>


---


