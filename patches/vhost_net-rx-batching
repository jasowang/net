Bottom: 3446ff8fa75c634d15e670c4a2a56cca4d7949a3
Top:    3446ff8fa75c634d15e670c4a2a56cca4d7949a3
Author: Jason Wang <jasowang@redhat.com>
Date:   2017-03-16 20:09:27 +0800

vhost_net: try batch dequing from skb array

We used to fetch one skb during recvmsg(). This could be inefficient
because of the bad cache utilization and spinlock touching for
each packet. This patch tries to batch them by calling batch dequeuing
helpers explicitly on the exported skb array and pass the skb back
through msg_control for underlayer socket to finish the userspace
copying.

Tests were done by XDP1:
- small buffer:
  Before: 1.88Mpps
  After : 2.20Mpps (+17%)
- mergeable buffer:
  Before:
  After :

FIXME: test for mergeable buffer

Signed-off-by: Jason Wang <jasowang@redhat.com>


---


