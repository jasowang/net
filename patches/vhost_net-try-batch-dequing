Bottom: 66dd3c6eeebc92b7a2ceae3c911fc2ed7184f410
Top:    66dd3c6eeebc92b7a2ceae3c911fc2ed7184f410
Author: Jason Wang <jasowang@redhat.com>
Date:   2017-03-20 13:53:59 +0800

vhost_net: try batch dequing from skb array

We used to dequeue one skb during recvmsg() from skb_array, this could
be inefficient because of the bad cache utilization and spinlock
touching for each packet. This patch tries to batch them by calling
batch dequeuing helpers explicitly on the exported skb array and pass
the skb back through msg_control for underlayer socket to finish the
userspace copying.

Tests were done by XDP1:
- small buffer:
  Before: 1.88Mpps
  After : 2.25Mpps (+19.6%)
- mergeable buffer:
  Before: 1.83Mpps
  After : 2.10Mpps (+14.7%)

Signed-off-by: Jason Wang <jasowang@redhat.com>


---


